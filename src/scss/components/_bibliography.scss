//
// Bibliography
//

.bibliography {
	padding: 0;
	list-style: none;
	text-align: left;

	// CSL styles only work correctly with content-box
	.csl-entry {
		word-wrap: break-word; // Break long URLs

		&,
		* {
			box-sizing: content-box;
		}
	}

	.csl-left-margin {
		word-wrap: normal;
	}

	.write & {
		margin: $space-lg (-$grid-gutter-width / 2);

		@media (min-width: $bp-md) {
			margin: $space-lg 0;
		}

		.citation {
			display: flex;
			align-items: center;
			border-top: 1px solid $shade-2;
			position: relative;

			&:last-child {
				border-bottom: 1px solid $shade-2;
			}

			&:focus {
				@at-root #{selector-replace(&, ".write", ".write.keyboard-user")} {
					outline-offset: -3px;

					& + .citation {
						border-top-color: transparent;
					}
				}
			}

			.citation-container {
				flex: 1 1 auto;
				display: flex;
				align-items: center;
				background-color: $body-bg;
				padding: ($space-lg - 7px) ($space-md - $space-xs) ($space-lg - 7px) $space-md; // Caps height
				transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1);
				position: relative;
				z-index: 20;
				cursor: pointer;

				&::before,
				&::after {
					content: "";
					position: absolute;
					left: 0;
					width: 100%;
					height: 1px;
					background-color: $shade-2;
				}

				&::before {
					top: -1px;
				}

				&::after {
					bottom: -1px;
				}

				&:hover {
					background-color: $shade-1;
				}
			}

			.csl-entry-container {
				flex: 1 1 0;
				margin-right: ($space-md - $space-xs);
				min-width: 0; // Enable word-wrap for long URLs
			}

			.csl-entry {
				margin: 0 !important; // Override entry-spacing defined in CSL
			}

			.btn-icon {
				flex: 0 0 auto;
				margin: (-$space-lg) 0;

				&.success {
					background: $btn-success-color;

					.icon-copy {
						display: none;
					}

					.icon-tick {
						display: block;
					}
				}
			}

			.icon-tick {
				display: none;
				color: $shade-0;
			}

			.btn-icon {
				&.copy,
				&.remove {
					background-color: $secondary;
					position: absolute;
					right: 8px;
					top: 50%;
					transform: translateY(-50%);
					margin: 0;
					z-index: 1;

					.icon {
						color: $shade-0;
					}
				}

				&.remove {
					background-color: $primary;
					transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1);
				}
			}

			&.options {
				&::after {
					content: "";
					position: absolute;
					left: 100%;
					top: 0;
					width: 32px;
					height: 100%;
					z-index: 0;
				}

				.citation-container {
					transform: translateX(-44px);
					position: relative;
					background-color: $shade-1;
				}

				.btn-icon {
					&.remove {
						transform: translate(36px, -50%);
					}
				}
			}
		}
	}

	.read-only & {
		font-size: 18px;
		margin-bottom: $space-xl - 7px;

		@media (min-width: $bp-md) {
			margin-bottom: $space-xxl - 7px;
		}
	}
}
